<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•–∏–º–∏—á–µ—Å–∫–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
    <link rel="stylesheet" href="style.css">
    <style>
        @media screen and (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            .right-panel {
                display: none; /* –°–∫—Ä—ã—Ç—å –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
            }
        }
    </style>
</head>
<body class="dark-theme">
    <h1>Chemcalc 1984</h1>
    <button class="theme-toggle-button" onclick="toggleTheme()">–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>

    <div class="container">
        <div class="panels">
            <div class="left-panel">
                <form id="calc-form">
                    <input type="text" id="substance" name="substance">
                    <label for="hide_base_ingredients">
                        <input type="checkbox" id="hide_base_ingredients" onchange="calculate()">
                        –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                    </label>
                    <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" id="quantity" name="quantity" value="0" onkeydown="handleKeyDown(event)">
                    <div class="quantity-control">
                        <div class="quantity-buttons">
                            <div class="quantity-buttons2">
                                <button type="button" onclick="changeQuantity(-1)">-1</button>
                                <button type="button" onclick="changeQuantity(-5)">-5</button>
                                <button type="button" onclick="changeQuantity(-10)">-10</button>
                                <button type="button" onclick="changeQuantity(-20)">-20</button>
                                <button type="button" onclick="changeQuantity(-50)">-50</button>
                                <button type="button" onclick="changeQuantity(-100)">-100</button>
                                <button type="button" onclick="changeQuantity(100)">+100</button>
                                <button type="button" onclick="changeQuantity(50)">+50</button>
                                <button type="button" onclick="changeQuantity(20)">+20</button>
                                <button type="button" onclick="changeQuantity(10)">+10</button>
                                <button type="button" onclick="changeQuantity(5)">+5</button>
                                <button type="button" onclick="changeQuantity(1)">+1</button>
                            </div>
                            <div class="result-class">
                                <pre id="result"></pre>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        <div class="right-panel">
            <img src="ad.png" alt="Your Image" style="max-width: 100%; height: auto;">
        </div>
        </div>
    <div class="recipe-panel">
        <div class="bottom-panel">
            <div id="recipe_buttons" class="recipe-buttons-container">
                <h2 id="recipe_category_title"></h2>
            </div>
        </div>
    </div>
    </div>
    <script>
        let baseIngredients = {};
        let recipes = {};
        let comments = {};
        let sortedRecipesByType = {};

        // –ó–∞–≥—Ä—É–∑–∫–∞ JSON-—Ñ–∞–π–ª–∞
        fetch('recipes.json')
            .then(response => response.json())
            .then(data => {
                baseIngredients = data.base_ingredients;
                recipes = data.recipes;
                comments = data.comments;

                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º
                let recipesByType = {};
                for (const [recipeName, recipeInfo] of Object.entries(recipes)) {
                    const recipeType = recipeInfo.type;
                    if (!recipesByType[recipeType]) {
                        recipesByType[recipeType] = [];
                    }
                    recipesByType[recipeType].push(recipeName);
                }

                // –ó–∞–¥–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                const categoryOrder = [
                    "–ö–æ–º–ø–æ–Ω–µ–Ω—Ç", "–ë–∞–∑–æ–≤–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ", "–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ", "–î—Ä—É–≥–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ",
                    "–ù–∞—Ä–∫–æ—Ç–∏–∫–∏", "–¢–æ–∫—Å–∏–Ω—ã", "–í–∑—Ä—ã–≤—á–∞—Ç–∫–∞", "–ï–¥–∞", "–†–∞–∑–Ω–æ–µ"
                ];

                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–ª–æ–≤–∞—Ä—è –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                sortedRecipesByType = {};
                categoryOrder.forEach(category => {
                    if (recipesByType[category]) {
                        sortedRecipesByType[category] = recipesByType[category];
                    }
                });

                console.log('Sorted recipes by type:', sortedRecipesByType); // Debug information

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤
                updateRecipeButtons();
            })
            .catch(error => {
                console.error('Error fetching the JSON file:', error);
            });

        function updateRecipeButtons() {
            const recipeButtonsContainer = document.getElementById('recipe_buttons');
            recipeButtonsContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–Ω–æ–ø–æ–∫

            for (const [category, recipes] of Object.entries(sortedRecipesByType)) {
                const categoryTitle = document.createElement('h2');
                categoryTitle.textContent = category;
                recipeButtonsContainer.appendChild(categoryTitle);

                recipes.forEach(recipe => {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'recipe-button';
                    button.textContent = recipe;
                    button.onclick = () => selectRecipe(recipe);
                    recipeButtonsContainer.appendChild(button);
                });
            }
        }

        function selectRecipe(recipe) {
            document.getElementById('substance').value = recipe;
            calculate();
        }

        function calculate() {
            const substance = document.getElementById('substance').value;
            const quantity = document.getElementById('quantity').value;
            const includeSublevels = document.getElementById('hide_base_ingredients').checked;
            const result = calculateIngredients(substance, quantity);
            let formattedResult = formatIngredients(result, includeSublevels);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ —Ä–µ—Ü–µ–ø—Ç–µ
            if (recipes[substance]) {
                const heatInfo = recipes[substance].heat;
                if (heatInfo && heatInfo.required) {
                    formattedResult += `\n–ù–∞–≥—Ä–µ—Ç—å –¥–æ ${heatInfo.temperature}¬∞K.`;
                }
                if (substance in comments) {
                    formattedResult += `\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comments[substance]}`;
                }
            }

            document.getElementById('result').innerText = formattedResult;
        }

        function calculateIngredients(substance, quantity) {
            if (baseIngredients[substance]) {
                return { [substance]: { quantity: quantity, components: {} } };
            }
            if (!recipes[substance]) {
                return {};
            }
            let result = {};
            const ingredients = recipes[substance].ingredients;
            const outputQty = recipes[substance].output;
            const multiplier = quantity / outputQty;
            for (const [ingredient, amount] of Object.entries(ingredients)) {
                const subResult = calculateIngredients(ingredient, amount * multiplier);
                if (result[ingredient]) {
                    for (const [subIngredient, subInfo] of Object.entries(subResult)) {
                        if (result[ingredient].components[subIngredient]) {
                            result[ingredient].components[subIngredient].quantity += subInfo.quantity;
                        } else {
                            result[ingredient].components[subIngredient] = subInfo;
                        }
                    }
                } else {
                    result[ingredient] = { quantity: amount * multiplier, components: subResult };
                }
            }
            return result;
        }

        function formatIngredients(ingredients, includeSublevels = true, level = 0) {
            let resultStr = '';
            const indent = 'üí®'.repeat(level);
            for (const [ingredient, info] of Object.entries(ingredients)) {
                let ingredientStr = `üêñ${indent}${ingredient}: ${info.quantity.toFixed(2)}`;
                if (recipes[ingredient] && recipes[ingredient].heat.required) {
                    ingredientStr += ` üî•`;
        }
        resultStr += ingredientStr + '\n';
        if (includeSublevels && info.components) {
            resultStr += formatIngredients(info.components, includeSublevels, level + 1);
        }
    }
    return resultStr;
}

        function changeQuantity(amount) {
            const quantityInput = document.getElementById('quantity');
            let currentQuantity = parseInt(quantityInput.value) || 0;
            currentQuantity += amount;
            if (currentQuantity < 0) currentQuantity = 0;
            quantityInput.value = currentQuantity;
            calculate();
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculate();
            }
        }

        function toggleTheme() {
            const body = document.body;
            const button = document.querySelector('.theme-toggle-button');
            body.classList.toggle('dark-theme');
            if (body.classList.contains('dark-theme')) {
                button.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
                button.classList.add('dark');
            } else {
                button.textContent = '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞';
                button.classList.remove('dark');
            }
        }
    </script>
</body>
</html>
